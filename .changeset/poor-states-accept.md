---
'@algoroot/itsme': patch
---

Graph 노드 반환값 및 상태 병합 방식 개선

- 각 노드에서 전체 `state`를 직접 오버라이딩(`...state`)하던 방식을 제거하고, 필요한 값만 리턴하도록 수정했습니다.  
  → LangGraph는 노드 리턴 값을 기존 상태와 자동 병합하기 때문에 `...state`는 불필요하다고 판단했습니다.
- `history` 상태를 제거하고, 대화 흐름은 `messages` 하나로 일관되게 관리하도록 구조를 단순화했습니다.

- 과도한 메시지 누적을 방지하기 위해, 최대 10개로 제한하는 `trim` 처리를 message를 사용하던 두번째(refineQuestion) 노드가 아닌 첫 노드에서만 수행하도록 변경했습니다.

- 프롬프트 호출 방식에서 `prompt.format()` → `prompt.invoke()`로 교체하여  
  LLM 호출 시 템플릿과 메시지가 함께 처리되도록 표준화했고, 이에 따라 응답 정확도와 LangSmith 기록 품질이 향상되었습니다.
